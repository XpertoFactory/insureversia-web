# Insureversia — CLAUDE.md

## Project Overview

Insureversia is an independent educational platform about AI in the insurance industry. Built with **Astro 5 + Svelte 5**, deployed to GitHub Pages at [insureversia.com](https://insureversia.com).

## Tech Stack

- **Framework:** Astro 5 (static output)
- **UI Components:** Svelte 5 (interactive widgets)
- **Styling:** Vanilla CSS design system (10 files in `src/styles/`)
- **i18n:** Custom system (`src/i18n/index.ts`) — English + Spanish only
- **Backend:** Firebase (Firestore, Auth, Analytics via GA4, AI Logic / Gemini)
- **Search:** Pagefind (runs post-build)
- **Deploy:** GitHub Pages via `.github/workflows/deploy.yml`

## Commands

```bash
npm run dev       # Start dev server
npm run build     # Build + generate Pagefind index
npm run preview   # Preview production build
```

## Project Structure

```
src/
  components/     # Astro + Svelte components
    AskInsureversia/  # AI chat assistant (ChatWidget.svelte + AskInsureversia.astro)
  content/        # Markdown content collections (quick-wins, what-to-do, what-not-to-do, faq)
  i18n/           # en.json, es.json, index.ts
  layouts/        # BaseLayout.astro
  lib/            # Shared utilities (firebase.ts, auth.ts, tiers.ts, conversations.ts, chat.ts, chat-persona.ts, chat-suggestions.ts, newsletter.ts)
  pages/          # File-based routing (30 EN pages)
  pages/es/       # Spanish mirror pages (30 ES pages)
  styles/         # Design system CSS
public/
  assets/         # Images, logos, fonts
resources/        # Internal docs, image prompts, site plan (not deployed)
```

## Key Conventions

- **i18n:** All user-facing text uses `t(locale, 'key.path')`. Add keys to both `en.json` and `es.json`. When adding a new page, create both `src/pages/{path}/index.astro` (EN) and `src/pages/es/{path}/index.astro` (ES mirror with `locale = 'es'` and one extra `../` on imports).
- **Content collections:** Markdown files in `src/content/{collection}/{locale}/`. Schemas defined in `src/content/config.ts`.
- **CSS:** No CSS framework. Design tokens in `variables.css`. Dark mode via `[data-mode="dark"]`. Theme toggle: Classic/Modern via `[data-theme="modern"]`.
- **Brand colors:** Navy `#0F2B46`, Gold `#C9A84C`, Teal `#00B4D8`
- **localStorage keys:** `insureversia-theme`, `insureversia-mode`, `insureversia-uid`, `insureversia-chat-usage`
- **sessionStorage keys:** `insureversia-chat-messages`
- **Naming:** `insuranceSector` (not practiceArea), `insureversiasTake` (not lawrasTake)
- **Personas:** 3 fictional voices — Vera (Gold/Strategist), Bruno (Slate-Blue/Guardian), Zaira (Teal/Catalyst)
- **Ask Insureversia:** AI chat assistant using Firebase AI SDK (Gemini). 4 personas (Insureversia default + Vera, Bruno, Zaira). System prompts in `chat-persona.ts`, suggestions in `chat-suggestions.ts`. Auth via `auth.ts` (Google + Email/Password). Tier-based limits via `tiers.ts`: anonymous 5 msgs/day (localStorage), registered 25 msgs/day (Firestore). Conversation history for registered users via `conversations.ts`.
- **Firestore collections:** `likes/`, `submissions/`, `users/` (usage tracking), `conversations/` (chat history with `messages/` subcollection), `newsletters/` (email subscriptions)
- **Firebase config files:** `firebase.json` (rules + indexes), `firestore.rules`, `firestore.indexes.json`

## Workflow Rules

- **Always update CHANGELOG.md** when committing changes
- Always ask before making major technology decisions
- Build must pass (`npm run build`) before committing — expect 60 pages (30 EN + 30 ES), zero errors
- **Sitemap** is auto-generated by `@astrojs/sitemap` on every build — no manual sitemap file
- Firebase client config in `.env` is public by design (security via Firestore rules)
- The `reference/` directory is gitignored — it contains a reference site, not project code
